<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="Docker, 苍穹之下">
    <meta name="description" content="想要属于一个自己的网站,菜鸡前端拼命前行">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Docker | 苍穹之下</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
     <!-- 雪花特效 -->
    <link rel="stylesheet" href="/css/snow.css">
	<!-- artitalk -->
    <link rel="stylesheet" type="text/css" href="/libs/artitalk/artitalk.min.css">
    <div id="snowzone">
	</div> 
	<script src="/js/snow.js"></script>

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="苍穹之下" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


    

                <body>
                    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">苍穹之下</span>
                </a>
            </div>
            

  <a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
  <ul class="right nav-menu">
    
      <li class="hide-on-med-and-down nav-item">
        
          <a href="/" class="waves-effect waves-light">
            
              <i class="fas fa-home" style="zoom: 0.6;"></i>
              
                <span>
                  首页
                </span>
          </a>
          
      </li>
      
      <li class="hide-on-med-and-down nav-item">
        
          <a href="/tags" class="waves-effect waves-light">
            
              <i class="fas fa-tags" style="zoom: 0.6;"></i>
              
                <span>
                  标签
                </span>
          </a>
          
      </li>
      
      <li class="hide-on-med-and-down nav-item">
        
          <a href="/categories" class="waves-effect waves-light">
            
              <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
              
                <span>
                  分类
                </span>
          </a>
          
      </li>
      
      <li class="hide-on-med-and-down nav-item">
        
          <a href="/archives" class="waves-effect waves-light">
            
              <i class="fas fa-archive" style="zoom: 0.6;"></i>
              
                <span>
                  归档
                </span>
          </a>
          
      </li>
      
      <li class="hide-on-med-and-down nav-item">
        
          <a href="/about" class="waves-effect waves-light">
            
              <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
              
                <span>
                  关于
                </span>
          </a>
          
      </li>
      
      <li class="hide-on-med-and-down nav-item">
        
          <a href="/contact" class="waves-effect waves-light">
            
              <i class="fas fa-comments" style="zoom: 0.6;"></i>
              
                <span>
                  留言板
                </span>
          </a>
          
      </li>
      
      <li class="hide-on-med-and-down nav-item">
        
          <a href="/friends" class="waves-effect waves-light">
            
              <i class="fas fa-address-book" style="zoom: 0.6;"></i>
              
                <span>
                  友情链接
                </span>
          </a>
          
      </li>
      
      <li class="hide-on-med-and-down nav-item">
        
          <a href="/artitalk" class="waves-effect waves-light">
            
              <i class="fas fa-heartbeat" style="zoom: 0.6;"></i>
              
                <span>
                  说说
                </span>
          </a>
          
      </li>
      
      <li class="hide-on-med-and-down nav-item">
        
            <a href="/Medias/musics" class="waves-effect waves-light">

              
                <i class="fas fa-list" style="zoom: 0.6;"></i>
                
                  <span>
                    Medias
                  </span>
                  <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
            </a>
            <ul class="sub-nav menus_item_child ">
              
                <li>
                  <a href="/Medias/musics">
                    
                      <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
                      
                        <span>
                          Musics
                        </span>
                  </a>
                </li>
                
                <li>
                  <a href="/Medias/movies">
                    
                      <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
                      
                        <span>
                          Movies
                        </span>
                  </a>
                </li>
                
                <li>
                  <a href="/Medias/books">
                    
                      <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
                      
                        <span>
                          Books
                        </span>
                  </a>
                </li>
                
                <li>
                  <a href="/Medias/galleries">
                    
                      <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
                      
                        <span>
                          Galleries
                        </span>
                  </a>
                </li>
                
            </ul>
            
      </li>
      
        <li>
          <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
          </a>
        </li>
  </ul>

  
<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">苍穹之下</div>
        <div class="logo-desc">
            
            想要属于一个自己的网站,菜鸡前端拼命前行
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/artitalk" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-heartbeat"></i>
			
			ArtiTalk
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Medias
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/Medias/musics " style="margin-left:75px">
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>Musics</span>
                  </a>
                </li>
              
                <li>

                  <a href="/Medias/movies " style="margin-left:75px">
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>Movies</span>
                  </a>
                </li>
              
                <li>

                  <a href="/Medias/books " style="margin-left:75px">
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Books</span>
                  </a>
                </li>
              
                <li>

                  <a href="/Medias/galleries " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>Galleries</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

                        



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Docker</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Docker/">
                                <span class="chip bg-color">Docker</span>
                            </a>
                        
                            <a href="/tags/config/">
                                <span class="chip bg-color">config</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/config/" class="post-category">
                                config
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-01-21
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-04-02
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    8.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    37 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h2><ol>
<li>镜像时一种轻量级,可执行的独立软件包,用来打包软件运行环境和基于运行环境开发的软件,它包含运行某个软件所需的所有内容,包括代码,环境运行时,库,环境变量等</li>
<li><strong>容器(container)</strong>:Docker利用容器技术,独立运行一个,或者一组应用,通过镜像来创建<ul>
<li>容器可以启动,停止,删除等基本命令</li>
<li>可以简单理解为一个简单的linux系统</li>
</ul>
</li>
<li><strong>仓库(repository)</strong>:存放镜像的地方(分为私有和公有)<ul>
<li>由于Docker hub是国外的(配置镜像加速)</li>
</ul>
</li>
</ol>
<p><img src="./docker%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="docker架构图"></p>
<h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3><blockquote>
<p>官方文档:<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
</blockquote>
<ol>
<li><p>安装<code>yum-utils</code>包:<code>yum install -y yum-utils</code></p>
</li>
<li><p>设置镜像的库:</p>
<ul>
<li><code>yum-config-manager</code>是一个程序,它可以管理主要的yum配置选项,切换启用或禁用的存储库,以及添加新的存储库</li>
<li><code>使用--add-repo快速添加yum源</code></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum-config-manager \
--add-repo \
https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>更新软件包的索引Centos 8:<code>yum makecache</code>,如果是7:<code>yum makecache fast</code></p>
</li>
<li><p>安装docker相关的源(<code>docker-ce</code>社区版,ee 企业版)</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum install docker-ce docker-ce-cli containerd.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>如果安装特定版本的docker<code>yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</code></p>
</blockquote>
</li>
<li><p>启动docker:<code>systemctl start docker</code></p>
</li>
<li><p>使用<code>docker version</code>是否安装成功</p>
</li>
<li><p>测试:<code>docker run hello-world</code></p>
</li>
<li><p>查看下载的镜像:<code>docker images</code></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@VM-12-17-centos &#x2F;]# docker images
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    feb5d9fea6a5   3 months ago   13.3kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>卸载docker</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 卸载依赖
yum remove docker-ce docker-ce-cli containerd.io
# 删除资源
rm -rf &#x2F;var&#x2F;lib&#x2F;docker # docker的默认工作路径
rm -rf &#x2F;var&#x2F;lib&#x2F;containerd # https:&#x2F;&#x2F;www.51cto.com&#x2F;article&#x2F;677744.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="配置镜像加速"><a href="#配置镜像加速" class="headerlink" title="配置镜像加速"></a>配置镜像加速</h3><blockquote>
<p>在阿里云的<code>容器服务里</code>找到<code>容器镜像服务</code>,打开<code>镜像工具</code>,打开<code>镜像加速器</code></p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mkdir -p &#x2F;etc&#x2F;docker
tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-&#39;EOF&#39;
&#123;
  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;xxxxxx.mirror.aliyuncs.com&quot;]
&#125;
EOF
systemctl daemon-reload
systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="docker的工作原理"><a href="#docker的工作原理" class="headerlink" title="docker的工作原理"></a>docker的工作原理</h3><blockquote>
<p>helloword的运行原理</p>
</blockquote>
<p><img src="./run%E7%9A%84%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="run的运行流程"></p>
<ul>
<li>工作流程:<ol>
<li>Docker是一个Client-Server结构的系统,Docker的守护进程运行在主机上.通过Socket从客户端访问</li>
<li><code>DockerServe</code>接收到<code>Docker-Client</code>的指令就会执行这个命令</li>
</ol>
</li>
</ul>
<p><img src="./%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="docker的工作流程"></p>
<ul>
<li>docker与虚拟机对比</li>
</ul>
<p><img src="https://pic2.zhimg.com/50/v2-e30ef11428ac454d101f2b7d3ffc067e_720w.jpg?source=1940ef5c" alt="比较"></p>
<ol>
<li>Docker有比虚拟机更少的抽象层</li>
<li>docker利用是宿主机的内核,虚拟机是需要Guest OS</li>
<li>docker不需要像虚拟机一样重新加载一个操作系统的内核,避免引导.虚拟机时加载Guset OS,分钟级别的,docker时利用宿主机操作系统,省略了这个复杂的功能</li>
</ol>
<table>
<thead>
<tr>
<th></th>
<th>Docker容器</th>
<th>LXC</th>
<th>VM</th>
</tr>
</thead>
<tbody><tr>
<td>虚拟化类型</td>
<td>OS虚拟化</td>
<td>OS虚拟化</td>
<td>OS虚拟化</td>
</tr>
<tr>
<td>性能</td>
<td>&#x3D;物理机性能</td>
<td>&#x3D;物理机性能</td>
<td>5%-20%的损耗</td>
</tr>
<tr>
<td>隔离性</td>
<td>NS隔离</td>
<td>NS隔离</td>
<td>强</td>
</tr>
<tr>
<td>QoS</td>
<td>Cgroup弱</td>
<td>Cgroup弱</td>
<td>强</td>
</tr>
<tr>
<td>安全性</td>
<td>中</td>
<td>差</td>
<td>强</td>
</tr>
<tr>
<td>GusetOS</td>
<td>只支持Linux</td>
<td>只支持Linux</td>
<td>全部</td>
</tr>
<tr>
<td>可迁移性</td>
<td>强</td>
<td>弱</td>
<td>强</td>
</tr>
</tbody></table>
<h3 id="镜像-image"><a href="#镜像-image" class="headerlink" title="镜像(image)"></a><strong>镜像(image)</strong></h3><blockquote>
<p>镜像时一种轻量级,可执行的独立软件包,用来打包软件运行环境和基于运行环境开发的软件,它包含运行某个软件所需的所有内容,包括代码,环境运行时,库,环境变量等</p>
</blockquote>
<ol>
<li>例如<code>tomcat镜像</code>运行起来之后<code>tomcat01容器</code>来提供服务</li>
<li>并且这个镜像可以创建多个容器(最终服务运行或者项目运行实在容器中)</li>
<li>所有的应用通过docker应用打包,可以直接跑起来</li>
</ol>
<blockquote>
<p>镜像获取的方法</p>
</blockquote>
<ol>
<li>从远程仓库下载</li>
<li>拷贝别人的镜像</li>
<li>自己制作一个<code>DockerFile</code></li>
</ol>
<h4 id="Docker镜像加载的基本原理"><a href="#Docker镜像加载的基本原理" class="headerlink" title="Docker镜像加载的基本原理"></a>Docker镜像加载的基本原理</h4><blockquote>
<p>UnionFS(联合文件系统):下载的时候一层一层的输出就是这个</p>
</blockquote>
<ul>
<li><strong>UnionFS(联合文件系统)</strong>:Union文件系统(UnifonFS)是一种分层,分量级并且高性能的文件系统,它支持对文件系统的修改作为一次提交来一层层的叠加,同时可以将不同的目录挂载到一个虚拟文件系统下(<code>unite serveral directories into a single virtual filesystem</code>).Union 文件系统时Docker镜像的基础,镜像可以通过分层类进行继承,基于镜像(没有父镜像),可以制作各种具体的应用镜像</li>
<li><strong>特性</strong>:一次同时加载多个文件系统,但是从外面看只能看到一个文件系统,联合加载会把各层文件系统叠加起来,这样<span style="color:red">最终文件系统会包含所有底层的文件和目录</span>(例如底层的centos文件会给所有的容器使用)</li>
</ul>
<blockquote>
<p>Docker 镜像加载原理</p>
</blockquote>
<ul>
<li>docker镜像实际室友一层一层文件系统组成</li>
<li><strong>bootfs(boot file system)</strong>:包含bootloader和kernel.<code>bootloader</code>主要加载<code>kernel</code>.Linux刚启动会加载bootfs文件系统,在Docker镜像最底层就是bootfs,并且与典型的Linux&#x2F;Unix系统是一样的,包含bootf加载器和内核.当bootf加载完成之后整个内核就在<strong>内存</strong>中,此时的内存使用权就有bootfs转交给内核,系统卸载bootfs</li>
<li><strong>rootfs(root file system)</strong>:在bootfs之上.包含的就是典型的Linux系统中的<code>/dev,/bin,/usr</code>等.rootfs就是不同操作系统的发行版,比如<code>Ubuntu</code>,<code>Centos</code>等</li>
</ul>
<p><img src="./docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86.png" alt=" "></p>
<ul>
<li>对于精简过的OS(操作系统),rootfs可以很小,只需要最基本的命令.工具和程序库就可以了,底层使用主机的内核就可以了,自己只需要提供rootfs.</li>
</ul>
<blockquote>
<p>分层理解</p>
</blockquote>
<ol>
<li>所有的Docker镜像都起始于一个基础镜像,当金星修改或增加新的内容时,就会在当前的镜像层之上,创建新的镜像层<ul>
<li>例如Centos创建一个新的镜像,此镜像位于第一层,如果在该镜像中加入Python包,就会在基础镜像层上创建第二个镜像层;如果继续添加,就会创建第三个镜像层</li>
</ul>
</li>
<li>在添加额外镜像的同时,镜像始终保持所有镜像的组合.<ul>
<li>例如下图中,每个层中都有三个文件,且保持相互隔离<br><img src="./dcoker%E4%B8%AD%E7%9A%84%E5%88%86%E5%B1%82.png" alt=" "></li>
</ul>
</li>
</ol>
<blockquote>
<p>特点</p>
</blockquote>
<ol>
<li>docker镜像都是只读的,当容器启动,一个新的科协曾被加载到镜像的顶部</li>
<li>这一层通常是容器层,容器之下都是镜像层</li>
</ol>
<p> <img src="./docker%E9%95%9C%E5%83%8F%E7%9A%84%E7%89%B9%E7%82%B9.png" alt="docker镜像的特点 "></p>
<h3 id="Commit镜像"><a href="#Commit镜像" class="headerlink" title="Commit镜像"></a>Commit镜像</h3><ol>
<li><code>docker commit -m=&quot;提交信息&quot; -a=&quot;作者&quot;</code> 提交容器成为一个新的副本</li>
<li>可以使用<code>docker images</code>,查看自己保存的镜像</li>
</ol>
<h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h2><blockquote>
<p>参考文档:<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
</blockquote>
<h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><ol>
<li><code>docker version</code>:显示docker的版本信息</li>
<li><code>docker info</code>:显示docker的系统信息,包括镜像和容器的数量</li>
<li><code>docker 命令 --help</code>:帮助命令</li>
</ol>
<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><ul>
<li><code>docker images</code>:查看所有本地主机上的镜像</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@VM-12-17-centos &#x2F;]# docker images
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    feb5d9fea6a5   3 months ago   13.3kB

# 可选项
  -a, --all     # 列出所有的镜像
  -q, --quiet   # 只显示镜像的ID  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li><code>REPOSITORY</code>:镜像的仓库源</li>
<li><code>TAG</code>:镜像的标签</li>
<li><code>IMAGE ID</code>:镜像的ID</li>
<li><code>CREATED</code>:镜像的创建时间</li>
<li><code>SIZE</code>:镜像的大小</li>
</ol>
<ul>
<li><code>docker search 镜像</code>:搜索镜像</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@VM-12-17-centos &#x2F;]# docker search mysql
NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                             MySQL is a widely used, open-source relation…   11997     [OK]       
mariadb                           MariaDB Server is a high performing open sou…   4595      [OK]       
mysql&#x2F;mysql-server                Optimized MySQL Server Docker images. Create…   899                  [OK]

# 可选项,通过搜索来过滤
--filter &#x3D; STARS &#x3D; 3000  搜索出的镜像是STARS&gt;3000的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>docker pull</code>下载镜像</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 下载镜像 docker pull 镜像名[:tags]
[root@VM-12-17-centos &#x2F;]# docker pull mongo
Using default tag: latest # 如果不屑tag,默认就是latest
latest: Pulling from library&#x2F;mongo
7b1a6ab2e44d: Pull complete # 分层下载,docker image的核心  联合文件系统
90eb44ebc60b: Pull complete 
5085b59f2efb: Pull complete 
c7499923d022: Pull complete 
019496b6c44a: Pull complete 
c0df4f407f69: Pull complete 
351daa315b6c: Pull complete 
a233e6240acc: Pull complete 
a3f57d6be64f: Pull complete 
dd1b5b345323: Pull complete 
Digest: sha256:5be752bc5f2ac4182252d0f15d74df080923aba39700905cb26d9f70f39e9702 # 签名
Status: Downloaded newer image for mongo:latest
docker.io&#x2F;library&#x2F;mongo:latest # 真实地址

# 下面两者等价
docker pull docker.io&#x2F;library&#x2F;mongo:latest
docker pull mysql

# 指定版本下载
docker pull mongo:3.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>docker rmi</code>:删除镜像</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker rmi -f 镜像id # 删除指定的镜像
docker rmi -f 镜像id 镜像id   # 删除多个指定的镜像
docker rmi -f $(docker images -aq) # 删除全部的镜像<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><hr></hr>

<blockquote>
<p>下载centos镜像来测试<code>docker pull centos</code></p>
</blockquote>
<h4 id="新建容器并启动"><a href="#新建容器并启动" class="headerlink" title="新建容器并启动"></a>新建容器并启动</h4><ul>
<li><strong>docker run [可选参数] image</strong></li>
</ul>
<blockquote>
<p>参数说明</p>
</blockquote>
<ul>
<li>–name&#x3D;”Name” 容器名字 tomcat01 tomcat01,用来区分容器</li>
<li>-d            后台方式运行</li>
<li>-it           使用交互方式运行,进入容器看内容</li>
<li>-p            指定容器的端口 -p 8080:8080<ul>
<li>-p ip:主机端口:容器端口</li>
<li>-p 主机端口:容器端口   (常用)</li>
<li>ip 容器端口</li>
<li>容器端口</li>
</ul>
</li>
<li>-P            随机指定端口</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 测试,启动并进入容器
[root@VM-12-17-centos &#x2F;]# docker run -it centos &#x2F;bin&#x2F;bash
[root@12164c10567a &#x2F;]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="列出所有的运行容器"><a href="#列出所有的运行容器" class="headerlink" title="列出所有的运行容器"></a>列出所有的运行容器</h4><ul>
<li><strong>docker ps</strong>:列出正在运行的容器<ul>
<li><code>-a</code>:列出正在运行的容器并带出历史运行过的容器</li>
<li><code>-n=?</code>:显示最近创建过的容器,例如<code>-n=1</code>显示最近的一个容器</li>
<li><code>-q</code>:只显示容器编号</li>
</ul>
</li>
</ul>
<h4 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h4><ul>
<li><strong>exit</strong>:直接退出容器并停止</li>
<li><code>Ctrl+P+Q</code>:容器不停止退出</li>
</ul>
<h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><ul>
<li><strong>docker rm 容器id</strong>:删除镜指定的容器,不能删除正在运行的容器,如果强制删除<code>rm -f</code></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker rm -f $(docker ps -aq) # 删除全部的容器
docker ps -a -q|xargs docker rm   # 删除所有的容器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="启动和停止容器的操作"><a href="#启动和停止容器的操作" class="headerlink" title="启动和停止容器的操作"></a>启动和停止容器的操作</h4><ul>
<li><strong>docker start  容器id</strong>:启动容器</li>
<li><strong>docker restart 容器id</strong>:重启容器</li>
<li><strong>docker stop 容器id</strong>:停止当前容器</li>
<li><strong>docker kill 容器id</strong>:强制停止容器</li>
</ul>
<h3 id="常用的其它命令"><a href="#常用的其它命令" class="headerlink" title="常用的其它命令"></a>常用的其它命令</h3><h4 id="后台启动容器"><a href="#后台启动容器" class="headerlink" title="后台启动容器"></a>后台启动容器</h4><ul>
<li><strong>docker run -d 镜像名</strong></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@VM-12-17-centos &#x2F;]# docker run -d centos

# docker ps:发现centos停止了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>常见的问题:<ol>
<li><span style="color:red">docker容器使用后台运行,就必须有一个前台进程,docker发现没有应用,就会自动停止</span></li>
<li>例如nginx容器启动后,发现自己没有提供服务就会自动停止</li>
</ol>
</li>
</ul>
<h4 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h4><ul>
<li><strong>docker -f -t –tail</strong><ul>
<li><code>-f</code>:显示日志</li>
<li><code>-t</code>:带上时间戳</li>
<li><code>--tail</code>:显示多少条日志</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker -f -t --tail 10 af1770f5884f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="查看容器内部的进程命令"><a href="#查看容器内部的进程命令" class="headerlink" title="查看容器内部的进程命令"></a>查看容器内部的进程命令</h4><ul>
<li><strong>docker top 容器id</strong></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@VM-12-17-centos ~]# docker top 4fc2d1f7bf97
UID                 PID                  PPID    C         STIME               TTY                 TIME                CMD
root                12339               12319    0        15:58               pts&#x2F;0               00:00:00            &#x2F;bin&#x2F;bash              <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="查看容器的元数据-重要"><a href="#查看容器的元数据-重要" class="headerlink" title="查看容器的元数据(重要)"></a>查看容器的元数据(重要)</h4><ul>
<li><strong>docker inspect 镜像&#x2F;容器id</strong></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@VM-12-17-centos ~]# docker inspect 7a447721e405<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="进入当前正在运行的容器"><a href="#进入当前正在运行的容器" class="headerlink" title="进入当前正在运行的容器"></a>进入当前正在运行的容器</h4><blockquote>
<p>通常容器都是使用后台方式运行.需要进入容器修改一些配置</p>
</blockquote>
<ul>
<li><strong>docker exec -it 容器id bashShell</strong>&#x2F;<strong>docker attach 容器id</strong></li>
</ul>
<ol>
<li>第一种:<code>docker exec -it 7a447721e405 /bin/bash</code></li>
<li>第二种:<code>docker attach 7a447721e405</code></li>
</ol>
<ul>
<li>注意:<span style="color:red">第一个是进入容器后开启一个新的终端,第二个是进入一个容器正在执行的终端</span></li>
</ul>
<h4 id="从容器中拷贝到主机上"><a href="#从容器中拷贝到主机上" class="headerlink" title="从容器中拷贝到主机上"></a>从容器中拷贝到主机上</h4><ul>
<li><strong>docker cp</strong></li>
</ul>
<blockquote>
<p>将已经停止的容器中的内容拷贝到主机</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@VM-12-17-centos &#x2F;]# docker cp 7a447721e405:&#x2F;home&#x2F;test.md &#x2F;home<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>使用-v卷的技术可以实现自动同步</p>
</blockquote>
<h4 id="查看cpu状态"><a href="#查看cpu状态" class="headerlink" title="查看cpu状态"></a>查看cpu状态</h4><ul>
<li><strong>docker stats</strong>:查看docker的cpu状态</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><table>
<thead>
<tr>
<th>命令</th>
<th>原文</th>
<th>译</th>
</tr>
</thead>
<tbody><tr>
<td>attach</td>
<td>Attach to a running container</td>
<td>当前shel11下attach连接指定运行镜像</td>
</tr>
<tr>
<td>build</td>
<td>Build an image from a Dockerfile</td>
<td>通过Dockerfile 定制镜像</td>
</tr>
<tr>
<td>commit</td>
<td>Create a new image from a container changes</td>
<td>提交当前容器为新的镜像</td>
</tr>
<tr>
<td>cp</td>
<td>Copy files&#x2F;folders from the containers filesystem to the host path</td>
<td>从容器中拷贝指定文件或者目录到宿主机中</td>
</tr>
<tr>
<td>create</td>
<td>Create a new container</td>
<td>创建一个新的容器,同run, 但不启动容器</td>
</tr>
<tr>
<td>diff</td>
<td>Inspect changes on a container’s filesys tem</td>
<td>查看docker容器变化</td>
</tr>
<tr>
<td>events</td>
<td>Get rea1 time events from the server</td>
<td>从docker 服务获取容器实时事件</td>
</tr>
<tr>
<td>exec</td>
<td>Run a command in an existing container</td>
<td>在已存在的容器 上运行命令</td>
</tr>
<tr>
<td>export</td>
<td>Stream the contents of a container as a tar archive</td>
<td>导出容器的内容流作为一个tar归档文件[对应import ]</td>
</tr>
<tr>
<td>history</td>
<td>Show the history of an image</td>
<td>展示一个镜像形成历史</td>
</tr>
<tr>
<td>images</td>
<td>List images</td>
<td>列出系统当前镜像:</td>
</tr>
<tr>
<td>import</td>
<td>Create a new filesystem image from the contents of a tarba1l</td>
<td>从tar包中的内容创建一个新的文件系统镜像[对应export]</td>
</tr>
<tr>
<td>info</td>
<td>Display sys tem-wide i nformation</td>
<td>显示系统相关信息</td>
</tr>
<tr>
<td>inspect</td>
<td>Return 1ow-1eve1 information on a container</td>
<td>查看容器详细信息</td>
</tr>
<tr>
<td>kill</td>
<td>Ki11 a running container</td>
<td>ki1l 指定docker 容器</td>
</tr>
<tr>
<td>load</td>
<td>Load an image from a tar archive</td>
<td>从一个tar包中加载一个镜像[对应save]</td>
</tr>
<tr>
<td>login</td>
<td>Register or Login to the docker registry server</td>
<td>住册或者登陆一个docker源服务器</td>
</tr>
<tr>
<td>logout</td>
<td>Log out from a Docker registry server</td>
<td>从当前Docker registry 退出</td>
</tr>
<tr>
<td>1ogs</td>
<td>Fetch the 1ogs of a container</td>
<td>输出当前容器日志信息</td>
</tr>
<tr>
<td>port</td>
<td>lookup the public-facing port which is NAT-ed to PRIVATE_ PORT</td>
<td>查看映射端口对应的容器内部源端</td>
</tr>
<tr>
<td>pause</td>
<td>Pause a11 processes within a container</td>
<td>暂停容器</td>
</tr>
<tr>
<td>ps</td>
<td>List containers</td>
<td>列出容器列表</td>
</tr>
<tr>
<td>pull</td>
<td>Pull an image or a repository from the docker registry server</td>
<td>从docker镜像源服务器拉取指定镜像或者库镜像</td>
</tr>
<tr>
<td>push</td>
<td>Push an image or a repository to the docker registry server</td>
<td>推送指定镜像或者库镜像至docker源服务器</td>
</tr>
<tr>
<td>restart</td>
<td>Restart a running container</td>
<td>重启运行的容器</td>
</tr>
<tr>
<td>rm</td>
<td>Remove one or more : containers</td>
<td>移除一个或者多个容器</td>
</tr>
<tr>
<td>rmi</td>
<td>Remove one or more images</td>
<td>移除一个或多个镜像[无容器使用该镜像才可删除,否则需删除相关容器才可继续或-f强制删除]</td>
</tr>
<tr>
<td>run</td>
<td>Run a command in a . new container</td>
<td>创建一个新的容器并运行一个命令</td>
</tr>
<tr>
<td>save</td>
<td>Save an image to a tar archive</td>
<td>保存一个镜像为一个tar包[对应load]</td>
</tr>
<tr>
<td>search</td>
<td>Search for an image on the Docker Hub</td>
<td>在docker hub中搜索镜像</td>
</tr>
<tr>
<td>start</td>
<td>Start a stopped containers</td>
<td>启动容器</td>
</tr>
<tr>
<td>stop</td>
<td>Stop a running containers</td>
<td>停止容器</td>
</tr>
<tr>
<td>tag</td>
<td>Tag an image into a repository</td>
<td>给源中镜像打标签</td>
</tr>
<tr>
<td>stats</td>
<td>Display a live stream of container(s) resource usage statistics</td>
<td>查看cpu状态</td>
</tr>
<tr>
<td>top</td>
<td>Lookup the running processes of a container</td>
<td>查看容器中运行的进程信息</td>
</tr>
<tr>
<td>unpause</td>
<td>Unpause a paused container</td>
<td>取消暂停容器</td>
</tr>
<tr>
<td>version</td>
<td>Show the docker vers ion information</td>
<td>查看docker版本号</td>
</tr>
<tr>
<td>wait</td>
<td>B1ock until a container stops, then print its exit code</td>
<td>截取容器停止时的退出状态值</td>
</tr>
</tbody></table>
<h2 id="案列"><a href="#案列" class="headerlink" title="案列"></a>案列</h2><blockquote>
<p>以装nginx为例</p>
</blockquote>
<ol>
<li>搜索镜像:<code>docker search nginx</code>(dockerhub更方便)</li>
<li>下载镜像:<code>docker pull nginx</code></li>
<li>查找镜像:<code>docker images</code></li>
<li>以后台方式运行容器,改名并且映射端口后:<code>docker run -d --name nginx01 -p 3401:80 nginx</code></li>
<li>查看运行的容器:<code>docker ps</code></li>
<li>测试容器是否成功:<code>curl localhost:3401</code></li>
<li>进入容器内部:<code>docker exec -it nginx01 /bin/bash</code></li>
<li>停止容器:<code>docker stop nginx01</code></li>
<li>删除指定容器:<code>docker rm nginx01</code></li>
</ol>
<p><img src="./%E7%AB%AF%E5%8F%A3%E6%9A%B4%E9%9C%B2.png" alt="端口暴露"></p>
<blockquote>
<p>安装<code>tomcat</code></p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 官网使用命令
docker run -it --rm -p 8888:8080 tomcat:9.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol>
<li>nginx的案列是启动在后台,停止了容器还是可以查到.</li>
<li><code>docker run -it --rm</code>:<code>--rm</code>一般用来测试,用完就会被删除</li>
</ol>
<h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><blockquote>
<p>Docker 容器中产生的数据,同步到本地.本地的数据也可以在容器中查看</p>
</blockquote>
<ol>
<li>容器和主机可以数据共享</li>
<li>容器和容器之间也可以数据共享</li>
</ol>
<blockquote>
<ul>
<li>windows:<code>docker run -it -v /d/test:/home centos</code>,路径要和linux的风格相同</li>
<li>linux: <code>docker run -it -v /home/test:/home centos</code></li>
<li>解释一下linux的吧:就是将<strong>容器中</strong><code>/home</code>目录下的文件同步到<strong>主机中</strong><code>/home/test</code></li>
</ul>
</blockquote>
<ul>
<li>使用<code>docker inspect</code>:查看容器的详细信息</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 挂载
&quot;Mounts&quot;: [
    &#123;
        &quot;Type&quot;: &quot;bind&quot;,
        &quot;Source&quot;: &quot;&#x2F;d&#x2F;test&quot;, # 主机内地址
        &quot;Destination&quot;: &quot;&#x2F;home&quot;, # docker容器的地址
        &quot;Mode&quot;: &quot;&quot;,
        &quot;RW&quot;: true,
        &quot;Propagation&quot;: &quot;rprivate&quot;
    &#125;
]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>安装mongoDB,官网:<a target="_blank" rel="noopener" href="https://hub.docker.com/_/mongo">https://hub.docker.com/_/mongo</a>(<span style="color:red">mongoDB的配置文件和数据文件都在&#x2F;data下面</span>)</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># -v:数据卷挂载
# -e:设置环境配置

# 官方安装
docker run --name some-mongo -v &#x2F;my&#x2F;own&#x2F;datadir:&#x2F;data&#x2F;db -d mongo

# 自己尝试连接
docker run -d -p 27017:27017 -v &#x2F;g&#x2F;DBMS&#x2F;mongo&#x2F;data:&#x2F;data -e MONGO_INITDB_ROOT_USERNAME&#x3D;root -e MONGO_INITDB_ROOT_PASSWORD&#x3D;123456 mongo
# 启动之后可以在本地使用连接<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="具名挂载和匿名挂载"><a href="#具名挂载和匿名挂载" class="headerlink" title="具名挂载和匿名挂载"></a>具名挂载和匿名挂载</h3><ol>
<li><code>docker run -d -P --name nginx01 -v /etc/nginx nginx</code>,不指定主机的映射目录(匿名挂载)</li>
<li><code>docker run -d -P --name nginx01 -v test:/etc/nginx nginx</code>,不指定主机的映射目录(具名挂载)</li>
<li>查看所有的<code>volumn</code>(挂载卷)的情况</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">G:\&gt;docker volume ls
DRIVER    VOLUME NAME
local     0c65a12280af5da18c06169e98ceb7493a80082ac39cf5fc5a01263958ede773
local     test
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>如果是匿名挂载,会自动映射到<code>&quot;/var/lib/docker/volumes/xxx/_data&quot;</code></li>
</ul>
<blockquote>
<p>使用<code>docker volume inspect test</code>可以查找挂载路径</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[
 &#123;
   &quot;CreatedAt&quot;: &quot;2022-01-22T10:27:43Z&quot;,
   &quot;Driver&quot;: &quot;local&quot;,
   &quot;Labels&quot;: null,
   &quot;Mountpoint&quot;: &quot;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;test&#x2F;_data&quot;,
   &quot;Name&quot;: &quot;test&quot;,
   &quot;Options&quot;: null,
   &quot;Scope&quot;: &quot;local&quot;
 &#125;
]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>通过具名挂载可以很容易的找到一个卷,大多数情况下在使用<code>具名挂载</code></p>
</blockquote>
<ol>
<li><code>-v 容器内路径</code>:匿名挂载</li>
<li><code>-v 卷名:容器内路径</code>:具名挂载</li>
<li><code>-v /宿主路径:/容器内路径</code>:指定路径挂载</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># ro &#x3D;&#x3D;&#x3D;&gt;readonly 只读,只能通过宿主机来操作,容器内部无法操作
# rw &#x3D;&#x3D;&#x3D;&gt;readwrite 可读可写(默认)
# 如果设置了这些权限,容器就有限定

docker run -d -P --name nginx01 -v test:&#x2F;etc&#x2F;nginx:ro nginx
docker run -d -P --name nginx01 -v test:&#x2F;etc&#x2F;nginx:rw nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><blockquote>
<p>很多官方的镜像都是基础包.利用dockerfile自己去搭建镜像</p>
</blockquote>
<ul>
<li>构建的大概流程<ol>
<li>编写一个<code>dockerFile</code>文件</li>
<li><code>docker build</code>构建成为一个镜像</li>
<li><code>docker run</code>运行镜像</li>
<li><code>docker push</code>发布镜像(dockerhub仓库)</li>
</ol>
</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">FROM scratch
ADD centos-8-x86_64.tar.xz &#x2F;
LABEL org.label-schema.schema-version&#x3D;&quot;1.0&quot;     org.label-schema.name&#x3D;&quot;CentOS Base Image&quot;     org.label-schema.vendor&#x3D;&quot;CentOS&quot;     org.label-schema.license&#x3D;&quot;GPLv2&quot;     org.label-schema.build-date&#x3D;&quot;20210915&quot;
CMD [&quot;&#x2F;bin&#x2F;bash&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="DockerFile构建"><a href="#DockerFile构建" class="headerlink" title="DockerFile构建"></a>DockerFile构建</h3><ol>
<li>每个保留关键字(指令)都必须是大写字母</li>
<li>执行从上到下的顺序</li>
<li># 表示注释</li>
<li>每一个指令都会创建一个新的镜像层并提交</li>
</ol>
<p><img src="./dockerFile%E6%9E%84%E5%BB%BA.png" alt="dockerFile构建"></p>
<ul>
<li><code>DockerFile</code>:构建文件,定义步骤,生成源代码</li>
<li><code>DockerImages</code>:通过<code>DockerFile</code>构建生成的镜像(最终运行和发布)</li>
<li><code>Docker容器</code>:镜像运行起来提供的服务器</li>
</ul>
<blockquote>
<p>dockerFile的zhiling</p>
</blockquote>
<table>
<thead>
<tr>
<th>FROM</th>
<th>基础镜像,构建的开始</th>
</tr>
</thead>
<tbody><tr>
<td>MAINTAINER(已启用)</td>
<td>镜像的作者,姓名+邮箱</td>
</tr>
<tr>
<td>LABEL</td>
<td>代替<code>MAINTAINER</code>,LABEL指令添加元数据到一个镜像。LABEL是一个键值对(可以有很多)</td>
</tr>
<tr>
<td>RUN</td>
<td>构建的时刻运行的命令</td>
</tr>
<tr>
<td>ADD</td>
<td>步骤,需要添加的镜像文件</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>镜像的工作目录</td>
</tr>
<tr>
<td>VOLUME</td>
<td>挂载的目录</td>
</tr>
<tr>
<td>EXPOSE</td>
<td>暴露端口(不暴露就需要用<code>-p</code>)</td>
</tr>
<tr>
<td>CMD</td>
<td>指定容器启动时候要运行的命令,只有最后一个会生效,可被ENTRYPOINT替代</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>指定容器启动时候要运行的命令,可以追加命令</td>
</tr>
<tr>
<td>ONBUILD</td>
<td>构建一个被继承的<code>DockerFile</code>就会运行<code>ONBUILD</code>指令,触发指令</td>
</tr>
<tr>
<td>COPY</td>
<td>类似ADD,将文件拷贝到镜像中</td>
</tr>
<tr>
<td>ENV</td>
<td>构建的时候生成环境变量</td>
</tr>
</tbody></table>
<blockquote>
<p>构建centos</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 1.编写DockerFile文件
FROM centos
LABEL name&#x3D;&quot;fw&quot; email&#x3D;&quot;zyj17715640603@gmail.com&quot;
ENV MYPATH &#x3D; &#x2F;usr&#x2F;local
WORKDIR $&#123;MYPATH&#125; # 进入容器之后的工作目录
RUN yum -y install vim # 添加工具
RUN yum -y install net-tools # 添加工具
EXPOSE 80 # 暴露端口
CMD echo $MYPATH
CMD echo &quot;---------&quot;
CMD &#x2F;bin&#x2F;bash

# 2.通过这个构建镜像
# 命令 docker build -f (构建的DockerFile文件) -t (输出的镜像名) .

[root@VM-12-17-centos Docker]# docker build -f DockerFile  -t mycentos:0.1 .

# 3.查看镜像的构建过程&#96;docker history 镜像名&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>注意:<span style="color:red">如果直接将文件命名<code>Dockerfile</code>,那么不需要加<code>-f</code>docker会自动寻找</span></li>
<li>使用<code>ADD</code>添加的文件会自动解压,例如<code>apache-tomcat-8.5.75.tar.gz</code></li>
</ul>
<blockquote>
<p><code>CMD</code>和<code>ENTRYPOINT</code>的区别</p>
</blockquote>
<ul>
<li>大部分linux发行版的基础镜像里面调用CMD命名,指定容器启动后直接执行<code>/bin/bash</code>或者<code>/bin/sh</code>,这样镜像就会默认进入交互的<code>shell</code></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">FROM centos
...
CMD &quot;&#x2F;bin&#x2F;bash&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>CMD给出的是一个容器的默认可执行体,也就是容器启动以后,默认的执行命名.</p>
</li>
<li><p>也就是说,如果<span style="color:red">docker run没有指定的任何的执行命名或者dockfile里面也没有entrypoint</span>,那么就会执行cmd指定的默认的执行命名执行</p>
</li>
<li><p>有三种用法:</p>
<ol>
<li><p>shell格式的形式:例如<code>npm install</code>.命令默认是在<code>/bin/sh -c</code>下执行的.</p>
<pre class="line-numbers language-dockerFile" data-language="dockerFile"><code class="language-dockerFile">FROM centos
...
CMD echo &quot;hello&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>当我们运行<code>docker run...</code>的时候,会调用<code>/bin/bsah</code>然后打印出<code>hello</code></li>
</ul>
</li>
<li><p>exec格式的形式(推荐使用):例如<code>[&quot;npm&quot;,&quot;install&quot;]</code>.并且第一个参数必须是全路径,并且一个<code>dockerfile</code>只能有一个cmd,如果有多个,则指会后最后一个生效.</p>
<ul>
<li>上面的方式改写:<code>[&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;echo&quot;,&quot;hello&quot;]</code></li>
<li><span style="color:red">如果我们在run的时候指定了命令或者有entrypoint,那么cmd就会被覆盖</span><ul>
<li><code>docker run ... echo &quot;world&quot;</code>,那么控制台就会打印<code>world</code>,而不是默认的hello</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li><p><code>ENTRYPOINT</code>默认是在shell环境下执行的,与CMD有区别.</p>
<ul>
<li>如果run命名后有东西,那么全部会作为<code>entrypoint</code>的参数.</li>
<li>如果run后面没有东西,但是CMD有,那么CMD的全部内容会作为entrypoint的参数,这同时是cmd的第三种用法</li>
</ul>
</li>
<li><p>exec形式:将CMD当作默认的参数</p>
<pre class="line-numbers language-doeckerFile" data-language="doeckerFile"><code class="language-doeckerFile">FROM centeos
...
CMD [&quot;hello&quot;]
ENTRYPOINT [&quot;echo&quot;,&quot;hello&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>如果运行<code>doecker run ...</code>,会直接打印<code>hello hello</code></li>
<li>如果运行<code>docker run ... world</code>,那么cmd就会被覆盖,打印<code>hello world</code></li>
</ul>
</li>
<li><p>如果使用shell模式:shell的形式会使<code>ENTRYPOINT</code>忽略任何CMD或者docker运行的命令行参数</p>
</li>
<li><p>如果需要提供默认的命令或在docker容器运行时可以从命令行覆盖的参数时,使用<code>CMD</code></p>
</li>
<li><p>最好的选择是使用<code>exec</code>,而不是shell命令</p>
</li>
</ul>
<h3 id="自己手动配置tomcat的Dockerfile"><a href="#自己手动配置tomcat的Dockerfile" class="headerlink" title="自己手动配置tomcat的Dockerfile"></a>自己手动配置tomcat的Dockerfile</h3><blockquote>
<p>首先编写<code>Dockerfile</code></p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">FROM centos
LABEL name&#x3D;&quot;fw&quot; mail&#x3D;&quot;zyj17715640603@gmail.com&quot;
COPY  README.md &#x2F;usr&#x2F;local&#x2F;README.md
ADD jdk-17_linux-x64_bin.tar.gz &#x2F;usr&#x2F;local
ADD apache-tomcat-9.0.58.tar.gz &#x2F;usr&#x2F;local

RUN yum -y install vim

ENV MYPATH  &#x2F;usr&#x2F;local

WORKDIR $&#123;MYPATH&#125;

ENV JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;jdk-17.0.2

ENV CATALINA_HOME &#x2F;usr&#x2F;local&#x2F;apache-tomcat-9.0.58
ENV CATALINA_BASH &#x2F;usr&#x2F;local&#x2F;apache-tomcat-9.0.58
# :代表把之前的路径也加入搜索路径(也就是分割符),windows是 ;
ENV PATH  $PATH:$&#123;JAVA_HOME&#125;&#x2F;bin:$&#123;CATALINA_HOME&#125;&#x2F;lib:$&#123;CATALINA_HOME&#125;&#x2F;bin

EXPOSE 8080

CMD &#x2F;usr&#x2F;local&#x2F;apache-tomcat-9.0.58&#x2F;bin&#x2F;startup.sh &amp;&amp; tail -F &#x2F;usr&#x2F;local&#x2F;apache-tomcat-9.0.58&#x2F;bin&#x2F;logs&#x2F;catalina.out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>构建:<code>docker build -t diytomcat .</code></li>
<li>启动:<code>tomcat</code></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d -p 3401:8080 --name diytomcat01 -v &#x2F;home&#x2F;tomcat&#x2F;test:&#x2F;usr&#x2F;local&#x2F;apache-tomcat-9.0.58&#x2F;webapps&#x2F;test -v &#x2F;home&#x2F;tomcat&#x2F;logs:&#x2F;usr&#x2F;local&#x2F;apache-tomcat-9.0.58&#x2F;webapps&#x2F;logs diytomcat<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h2><blockquote>
<p>发布到Dockerhub</p>
</blockquote>
<ol>
<li><p>登录账号<code>docker login -u (user) -p (password)</code></p>
</li>
<li><p>给images打一个标签(&#x2F;之前的得是docker用户名才能上传成功)</p>
<ul>
<li><code>denied: requested access to the resource is denied</code>:(可能用户名不对)</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker tag divtomcat fw1314&#x2F;divtomcat:v0.0.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>上传到远程仓库<code>docker push fw1314/divtomcat:v0.0.1</code></p>
<ul>
<li>提交的时候也是按层级提交</li>
</ul>
</li>
</ol>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances">发布到阿里云容器</a></p>
</blockquote>
<ol>
<li>在阿里云容器服务中创建个人实例</li>
<li>创建命名空间</li>
<li>创建容器镜像(选择本地)</li>
<li>参考<code>基本信息</code></li>
</ol>
<blockquote>
<p>镜像的导入导出</p>
</blockquote>
<ol>
<li><code>docker save</code>:将一个或多个<strong>image</strong>打包保存的工具<ul>
<li>官方:<code>Usage:docker save [OPTIONS] IMAGE [IMAGE...]</code></li>
<li>例如<code>docker save -o images.tar postgres:9.6 mongo:3.4</code>:将镜像库中的postgres和mongo打包</li>
</ul>
</li>
<li><code>docker load</code>:将打包后的镜像载入进来<ul>
<li>官方:<code>Usage:  docker load [OPTIONS]</code></li>
<li>例如:<code>docker load -i images.tar</code>把postgres:9.6和mongo:3.4载入进来,如果本地镜像库已经存在这两个镜像,将会被覆盖</li>
</ul>
</li>
</ol>
<blockquote>
<p>容器的快照</p>
</blockquote>
<ol>
<li><code>docker export</code>:将container的文件系统进行打包(只保存当时的快照)<ul>
<li>官方:<code>Usage:docker export [OPTIONS] CONTAINER</code></li>
<li>例如:<code>docker export -o postgres-export.tar postgres(指定的容器)</code>将正在执行的postgres容器打包</li>
</ul>
</li>
<li><code>docker import</code><ul>
<li>官方:<code>docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]]</code>:可以指定路径和重新命名</li>
<li>例如:<code>docker import postgres-export.tar postgres:latest</code>导入后会成为一个<code>image</code>(不会导出容器)</li>
</ul>
</li>
</ol>
<blockquote>
<p>区别</p>
</blockquote>
<ol>
<li><code>docker save</code>保存的是镜像(image),<code>docker export</code>保存的是容器(container)</li>
<li><code>docker load</code>用来载入镜像包,<code>docker import</code>用来载入容器包,但两者都会恢复为镜像</li>
<li><code>docker load</code>不能对载入的镜像重命名,而<code>docker import</code>可以为镜像指定新名称</li>
</ol>
<blockquote>
<p>参考:<a target="_blank" rel="noopener" href="https://jingsam.github.io/2017/08/26/docker-save-and-docker-export.html">https://jingsam.github.io/2017/08/26/docker-save-and-docker-export.html</a></p>
</blockquote>
<h2 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h2><ul>
<li>首先查看服务器的网络<code>ifconfig</code>,显示三个网络<ol>
<li><code>docker0</code>:docker自己生成的地址</li>
<li><code>eth0</code>:服务器的内网地址</li>
<li><code>lo</code>:本地回环地址</li>
</ol>
</li>
<li>启动一个容器,例如tomcat</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@VM-12-17-centos &#x2F;]# docker run -d -P --name tomcat01 tomcat<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>发现没有<code>ip addr</code>命令,进入容器<code>docker exec -it tomcat01 /bin/bash</code></li>
<li>下载<code>apt update &amp;&amp; apt install -y iproute2</code></li>
<li>查看容器内部的网址结构<code>docker exec -it tomcat01 ip addr</code></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1&#x2F;8 scope host lo
       valid_lft forever preferred_lft forever
8: eth0@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    link&#x2F;ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.17.0.2&#x2F;16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>ping 172.17.0.2</code>:宿主机可以ping通容器</li>
</ul>
<blockquote>
<p>原理</p>
</blockquote>
<ol>
<li><p>当我们启动一个容器的时候,docker就会给我们分配一个ip,只要安装docker,就会有一个网卡<code>docker0</code></p>
</li>
<li><p>网卡使用的是桥接模式</p>
</li>
<li><p>当我们再次<code>ifconfig</code></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 多出来的网络
9: veth9c8db14@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default 
   link&#x2F;ether a2:d2:1c:d0:7f:6a brd ff:ff:ff:ff:ff:ff link-netnsid 0
   inet6 fe80::a0d2:1cff:fed0:7f6a&#x2F;64 scope link 
      valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>多出来的网卡是按对出现的.<code>evth-pair</code>一段连着协议,一段彼此相连.<code>evth-pair</code>充当一个桥梁,彼此相连</p>
</blockquote>
</li>
<li><p>没有ping包.下载:<code>apt install iputils-ping</code></p>
</li>
<li><p>再启动一个tomcat,<code>tomcat01</code>ping<code>tomcat02</code>(发现可以ping通)</p>
</li>
</ol>
<p><img src="./docker%E7%BD%91%E7%BB%9C.png" alt="docker网络"></p>
<ol>
<li>tomcat01和tomcat02是公用的一个路由器(<code>docker0</code>)</li>
<li>所有的容器再不指定网络的情况下,都是docker0转发的,docker会给所有容器分配一个默认可用的ip</li>
<li>Docker使用的是Linux网桥,宿主机中是一个Docker容器的网桥docker0</li>
<li>Docker中的所有网络接口都是虚拟的(内网穿透)</li>
<li>只要删除容器,其中的一对网桥就消失</li>
</ol>
<h3 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h3><ol>
<li>创建一个<code>centos01</code>镜像<code>docker run -it --name centos01 centos</code></li>
<li>关联创建的<code>centos02</code>:<code>docker run -it --name centos02 --link centos01 centos</code><ol>
<li>在<code>centos02</code>中<code>ping centos01</code>完全可以ping通</li>
<li>在<code>centos01</code>中<code>ping centos02</code>不可以ping通<code>ping: centos02: Name or service not known</code></li>
</ol>
</li>
</ol>
<ul>
<li>使用<code>docker inspect centos02</code>查看host配置</li>
</ul>
<pre class="line-numbers language-JSON" data-language="JSON"><code class="language-JSON">&quot;HostConfig&quot;:&#123;
   &quot;Links&quot;: [
     &quot;&#x2F;centos01:&#x2F;centos02&#x2F;centos01&quot;
   ],
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<ul>
<li>进入<code>centos02</code>后查看host文件(<code>cat /etc/hosts</code>),发现–link就是在hosts配置中加了<code>172.17.0.2 centos01 2147d9e02181</code></li>
<li>现在已经不建议使用**–link**</li>
</ul>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.17.0.2      centos01 2147d9e02181
172.17.0.3      5561fc170ce7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><blockquote>
<p>查看所有的docker网络<code>docker network ls</code></p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">NETWORK ID     NAME      DRIVER    SCOPE
e8372c51dd7f   bridge    bridge    local
39fabbb25f72   host      host      local
dad25aaf302a   none      null      local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>网络模式(如果自己创建也会使用桥接模式)</p>
</blockquote>
<ol>
<li><code>bridge</code>:桥接模式(docker默认)</li>
<li><code>none</code>:不配置网络</li>
<li><code>host</code>:和主机共享网络</li>
<li><del><code>container</code>:容器网络联通(现在几乎不用,局限很大)</del></li>
</ol>
<blockquote>
<p>测试</p>
</blockquote>
<ol>
<li><p>直接启动的命令中会有一个默认的参数<code>--net bridge</code>,这个指代的就是docker0</p>
<ul>
<li><code>docker run -d --name tomcat01 (--net bridge) centos</code></li>
</ul>
</li>
<li><p><code>docker0</code>的特点:默认,域名不能访问,–link可以打通</p>
</li>
<li><p>自定义一个网络</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker network create --driver bridge --subnet 192.168.0.0&#x2F;16 --gateway 192.168.0.1 mynet
# subnet是子网掩码
# gateway是网关<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>使用<code>docker network inspect mynet</code>可以查看自定义网络的信息</p>
</li>
<li><p>自定义的网络非常的完善(不使用–link也可以互相ping通)</p>
</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">
docker run -it --name centos01 --net mynet centos
docker run -it --name centos02 --net mynet centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><span style="color:red">自定义的网络已经帮我们维护对应的关系,而<code>doker0</code>需要<code>--link</code></span>推荐使用.保证不同的集群使用不同的网络,保证集群是安全的</li>
</ul>
<h3 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h3><p><img src="./%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A.png" alt="docker网络连通"></p>
<blockquote>
<p>将tomcat加入到mynet网络中<code>docker network connect mynet tomcat01</code></p>
</blockquote>
<ul>
<li>使用<code>docker network connect mynet tomcat01</code>查看会发现在mynet网络中的Containers加入了tomcat01</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"Containers"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"3f575a99cc32404f226d6d56cdf28be3c52c7611ae334f19297a1069b1ac9d28"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"tomcat01"</span><span class="token punctuation">,</span>
        <span class="token property">"EndpointID"</span><span class="token operator">:</span> <span class="token string">"6e780a6c3a680ca28c9df28b1eb14fb5fc7470e72df27d8a7444b38e1b5a0a9b"</span><span class="token punctuation">,</span>
        <span class="token property">"MacAddress"</span><span class="token operator">:</span> <span class="token string">"02:42:c0:a8:00:02"</span><span class="token punctuation">,</span>
        <span class="token property">"IPv4Address"</span><span class="token operator">:</span> <span class="token string">"192.168.0.2/16"</span><span class="token punctuation">,</span>
        <span class="token property">"IPv6Address"</span><span class="token operator">:</span> <span class="token string">""</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><span style="color:red">在tomcat01中可以ping通mynet网中的任意一个容器</sapn></li>
</ul>
<h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">Docker Compose</a></h2><blockquote>
<p>Compose 适用于所有环境：生产、登台、开发、测试以及 CI 工作流程。您可以在常见用例中了解有关每个案例的更多信息。</p>
</blockquote>
<ul>
<li><p>使用 Compose 基本上是一个三步过程：</p>
<ol>
<li>定义您的应用程序的环境，Dockerfile以便可以在任何地方复制它。</li>
<li>定义构成您的应用程序的服务，<code>docker-compose.yml</code> 以便它们可以在隔离环境中一起运行。</li>
<li>运行<code>docker compose up</code>，<strong>Docker compose 命令</strong>启动并运行您的整个应用程序。docker-compose up也可以使用二进制<code>docker-compose</code>文件运行。</li>
</ol>
</li>
<li><p><code>docker-compose.yml</code>看起来像这样：</p>
</li>
</ul>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">version: &quot;3.9&quot;  # optional since v1.27.0
services:
  web:
    build: .
    ports:
      - &quot;5000:5000&quot;
    volumes:
      - .:&#x2F;code
      - logvolume01:&#x2F;var&#x2F;log
    links:
      - redis
  redis:
    image: redis
volumes:
  logvolume01: &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><blockquote>
<p>windows</p>
</blockquote>
<ul>
<li>Docker Desktop for Windows包括 Compose 以及其他 Docker 应用程序，因此大多数 Windows 用户不需要单独安装 Compose</li>
</ul>
<blockquote>
<p>Linux</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 使用国内的地址
curl -L &quot;https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.29.2&#x2F;docker-compose-$(uname -s)-$(uname -m)&quot; -o &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>对二进制文件应用可执行权限:<code>chmod +x /usr/local/bin/docker-compose</code></li>
<li>测试安装<code>docker-compose --version</code></li>
</ul>
<blockquote>
<p>官网的流程</p>
</blockquote>
<ol>
<li>一个应用<code>app.py</code></li>
<li><code>Dockerfile</code>应用打包为镜像</li>
<li><code>Docker-compose.yaml</code>文件:定义整个服务需要的环境.web,redis.完整的上线服务</li>
<li>启动<code>docker-compose up</code></li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Creating composetest_web_1   ... done
Creating composetest_redis_1 ... done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>docker执行的流程</p>
</blockquote>
<ol>
<li><p>创建网络</p>
</li>
<li><p>执行<code>Docker-compose.yaml</code></p>
</li>
<li><p>启动服务</p>
<ul>
<li>根据文件名<code>composetest</code>创建服务</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.9"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5000:5000"</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"redis:alpine"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="yaml配置"><a href="#yaml配置" class="headerlink" title="yaml配置"></a>yaml配置</h3><blockquote>
<ul>
<li>第一层,<code>version</code>:编写文件格式对应的<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/compose-file-v3/"><code>docker engine</code></a></li>
<li>第二层.<code>services</code>:编写文件对应的服务(可以无限往下写)</li>
</ul>
</blockquote>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5000:5000"</span>
    <span class="token key atrule">images</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"redis:alpine"</span>
    <span class="token punctuation">...</span>
  <span class="token punctuation">...</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<ul>
<li>第三层:其它配置,网络卷,全局规则</li>
</ul>
</blockquote>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
configs<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="每个服务里的编写规则"><a href="#每个服务里的编写规则" class="headerlink" title="每个服务里的编写规则"></a>每个服务里的编写规则</h4><blockquote>
<p><code>build</code>用于服务中构建项目</p>
</blockquote>
<ol>
<li><p><code>content</code>:指定为包含构建上下文路径的字符串</p>
</li>
<li><p><code>dockerfile</code>:指定在上下文中可选的<code>Dockerfile</code></p>
</li>
<li><p><code>image: webapp:tag</code>:生成一个名为webapp并标记为tag的镜像</p>
</li>
<li><p><code>cache_from</code>:用于解析缓存的镜像</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> .
  <span class="token key atrule">cache_from</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> alpine<span class="token punctuation">:</span>latest
    <span class="token punctuation">-</span> corp/web_app<span class="token punctuation">:</span><span class="token number">3.14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>network</code>RUN在构建期间设置容器连接网络(如果是none,则禁止网络)</p>
</li>
</ol>
<blockquote>
<p><code>command</code>:</p>
</blockquote>
<ol>
<li>覆盖默认命令:<code>command: bundle exec thin -p 3000</code></li>
<li>该命令也可以是一个列表:<code>command: [&quot;bundle&quot;, &quot;exec&quot;, &quot;thin&quot;, &quot;-p&quot;, &quot;3000&quot;]</code></li>
</ol>
<blockquote>
<p><code>container_name: my-web-container</code>指定容器名称</p>
</blockquote>
<ul>
<li>容器名称必须是唯一的，因此如果您指定了自定义名称，则无法将服务扩展到超过 1 个容器</li>
</ul>
<blockquote>
<p><code>depends_on</code>:表达服务之间的依赖关系(<span style="color:red">yml中的文件从下往上依次执行,要注意顺序</span>)</p>
</blockquote>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> db
  <span class="token punctuation">-</span> redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>deploy</code>:与集群相关的部署</p>
</blockquote>
<ul>
<li>参考:<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/compose-file-v3/#deploy">https://docs.docker.com/compose/compose-file/compose-file-v3/#deploy</a></li>
</ul>
<blockquote>
<p><code>entrypoint</code>:默认进入容器的入口</p>
</blockquote>
<ol>
<li>终端形式:<code>entrypoint:/code/entrypoint.sh</code></li>
<li>列表:<code>entrypoint: [&quot;php&quot;, &quot;-d&quot;, &quot;memory_limit=-1&quot;, &quot;vendor/bin/phpunit&quot;]</code></li>
</ol>
<blockquote>
<p><code>environment</code>:环境变量,可以设置数据库账号密码等</p>
</blockquote>
<ol>
<li>如果您的服务指定了构建environment选项，则在构建期间定义的变量 不会自动可见。</li>
<li>使用 args子选项build定义构建的环境变量.可以直接在这里获取</li>
</ol>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RACK_ENV=development
  <span class="token punctuation">-</span> SHOW=true <span class="token comment"># 布尔值不会被编译</span>
  <span class="token punctuation">-</span> SESSION_SECRET <span class="token comment"># 从args获取</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>expose</code>:公开端口而不将它们发布到主机 - 它们只能被链接服务访问。只能指定内部端口</p>
</blockquote>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">expose</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"3000"</span>
  <span class="token punctuation">-</span> <span class="token string">"8000"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>images</code>:指定启动容器的镜像。可以是<code>存储库/标签</code>或<code>镜像ID</code></p>
</blockquote>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">:</span><span class="token number">18.04</span>
<span class="token key atrule">image</span><span class="token punctuation">:</span> a4bc65fd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p><code>networks</code>:要加入的网络，引用顶级<code>networkskey</code>下的条目</p>
</blockquote>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> some<span class="token punctuation">-</span>network
     <span class="token punctuation">-</span> other<span class="token punctuation">-</span>network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>ports</code>:映射的端口号.如果有这个network_mode: host&#96;,不会启用</p>
</blockquote>
<ol>
<li>指定两个端口 (HOST:CONTAINER)</li>
<li>仅指定容器端口(为主机端口选择一个临时主机端口)</li>
<li>指定要绑定到两个端口的主机 IP 地址（默认为 0.0.0.0，表示所有接口）：( IPADDR:HOSTPORT:CONTAINERPORT)。如果 HOSTPORT 为空（例如127.0.0.1::80），则选择一个临时端口来绑定到主机上</li>
</ol>
<ul>
<li><strong>使用长语法</strong>:长格式语法允许配置无法以短格式表示的附加字段。<ol>
<li><code>target</code>: 容器内的端口</li>
<li><code>published</code>: 公开的端口</li>
<li><code>protocol</code>：端口协议（tcp或udp）</li>
<li><code>mode</code>：host用于在每个节点上发布主机端口，或ingress用于集群模式端口进行负载平衡</li>
</ol>
</li>
</ul>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">target</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">published</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> tcp
    <span class="token key atrule">mode</span><span class="token punctuation">:</span> host<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>restart</code>:什么情况下重启项目</p>
</blockquote>
<ol>
<li><code>no</code>:默认的重启策略，在任何情况下都不重启容器。</li>
<li><code>always</code>:容器总是重新启动。</li>
<li><code>on-failure</code>:如果退出代码指示出现故障错误，则该 策略会重新启动容器。</li>
<li><code>unless-stopped</code>:总是重新启动容器，除非容器停止（手动或其他方式）</li>
</ol>
<blockquote>
<p><code>volumes</code>可以将主机路径挂载为单个服务定义的一部分，无需在顶级(第三层)volumes键中定义它</p>
</blockquote>
<ol>
<li>type: 挂载类型volume, bind,tmpfs或npipe</li>
<li>source: 挂载的来源，主机上用于绑定挂载的路径，或者在 顶级volumeskey中定义的卷的名称。不适用于 tmpfs 挂载。</li>
<li>target: 容器中安装卷的路径</li>
<li>read_only: 将卷设置为只读的标志</li>
<li>bind: 配置额外的绑定选项<ul>
<li>propagation：用于绑定的传播模式</li>
</ul>
</li>
<li>volume：配置额外的音量选项<ul>
<li>nocopy: 创建卷时禁止从容器复制数据的标志</li>
</ul>
</li>
<li>tmpfs: 配置额外的 tmpfs 选项<ul>
<li>size: tmpfs 挂载的大小（以字节为单位）</li>
</ul>
</li>
</ol>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> volume
    <span class="token key atrule">source</span><span class="token punctuation">:</span> mydata
    <span class="token key atrule">target</span><span class="token punctuation">:</span> /data
    <span class="token key atrule">volume</span><span class="token punctuation">:</span>
      <span class="token key atrule">nocopy</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> bind
    <span class="token key atrule">source</span><span class="token punctuation">:</span> ./static
    <span class="token key atrule">target</span><span class="token punctuation">:</span> /opt/app/static<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>短语法</strong>:直接使用短语挂载<code>data-volume:/var/lib/backup/data</code></li>
</ul>
<h4 id="network配置"><a href="#network配置" class="headerlink" title="network配置"></a>network配置</h4><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">network1</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
  <span class="token key atrule">network2</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
  <span class="token punctuation">...</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/compose-file-v3/#host-or-none"><code>driver</code></a>:指定应为此网络使用的驱动程序</p>
</blockquote>
<ol>
<li><code>bridge</code>:桥接模式(docker默认)</li>
<li><code>overlay</code>:参考文档</li>
<li><code>host</code>和<code>none</code>:和主机共享网络或者不配置网络</li>
</ol>
<blockquote>
<p><code>external</code>:如果设置为true，则指定此网络是在 Compose 之外创建的</p>
</blockquote>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">outside</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>name</code>:为此网络设置自定义名称</p>
</blockquote>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不创建新网络,加入已存在的网络</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">network1</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app<span class="token punctuation">-</span>net<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Jack-zhang</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://mail.zyjcould.ltd/2022/01/21/docker/">http://mail.zyjcould.ltd/2022/01/21/docker/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Jack-zhang</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Docker/">
                                    <span class="chip bg-color">Docker</span>
                                </a>
                            
                                <a href="/tags/config/">
                                    <span class="chip bg-color">config</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'ha91At85XM1oBPn1UB63Rkxc-9Nh9j0Va',
        appKey: 'd4sclrxt1coswQE8xKNb0CEP',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/01/27/nginx/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="nginx">
                        
                        <span class="card-title">nginx</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            nginx的简单应用
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-01-27
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/config/" class="post-category">
                                    config
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/config/">
                        <span class="chip bg-color">config</span>
                    </a>
                    
                    <a href="/tags/nginx/">
                        <span class="chip bg-color">nginx</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/01/21/yuan-cheng-lian-jie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="远程连接">
                        
                        <span class="card-title">远程连接</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            远程连接
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/config/" class="post-category">
                                    config
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/config/">
                        <span class="chip bg-color">config</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 苍穹之下<br />'
            + '文章作者: Jack-zhang<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录
            </div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

    <div id="floating-toc-btn" class="hide-on-med-and-down">
        <a class="btn-floating btn-large bg-color">
            <i class="fas fa-list-ul"></i>
        </a>
    </div>
    

        <script src="/libs/tocbot/tocbot.min.js"></script>
        <script>
            $(function () {
                tocbot.init({
                    tocSelector: '#toc-content',
                    contentSelector: '#articleContent',
                    headingsOffset: -($(window).height() * 0.4 - 45),
                    collapseDepth: Number('0'),
                    headingSelector: 'h2, h3, h4'
                });

                // modify the toc link href to support Chinese.
                let i = 0;
                let tocHeading = 'toc-heading-';
                $('#toc-content a').each(function () {
                    $(this).attr('href', '#' + tocHeading + (++i));
                });

                // modify the heading title id to support Chinese.
                i = 0;
                $('#articleContent').children('h2, h3, h4').each(function () {
                    $(this).attr('id', tocHeading + (++i));
                });

                // Set scroll toc fixed.
                let tocHeight = parseInt($(window).height() * 0.4 - 64);
                let $tocWidget = $('.toc-widget');
                $(window).scroll(function () {
                    let scroll = $(window).scrollTop();
                    /* add post toc fixed. */
                    if (scroll > tocHeight) {
                        $tocWidget.addClass('toc-fixed');
                    } else {
                        $tocWidget.removeClass('toc-fixed');
                    }
                });

        
                    /* 修复文章卡片 div 的宽度. */
                    let fixPostCardWidth = function (srcId, targetId) {
                        let srcDiv = $('#' + srcId);
                        if (srcDiv.length === 0) {
                            return;
                        }

                        let w = srcDiv.width();
                        if (w >= 450) {
                            w = w + 21;
                        } else if (w >= 350 && w < 450) {
                            w = w + 18;
                        } else if (w >= 300 && w < 350) {
                            w = w + 16;
                        } else {
                            w = w + 14;
                        }
                        $('#' + targetId).width(w);
                    };

                    // 切换TOC目录展开收缩的相关操作.
                    const expandedClass = 'expanded';
                    let $tocAside = $('#toc-aside');
                    let $mainContent = $('#main-content');
                    $('#floating-toc-btn .btn-floating').click(function () {
                        if ($tocAside.hasClass(expandedClass)) {
                            $tocAside.removeClass(expandedClass).hide();
                            $mainContent.removeClass('l9');
                        } else {
                            $tocAside.addClass(expandedClass).show();
                            $mainContent.addClass('l9');
                        }
                        fixPostCardWidth('artDetail', 'prenext-posts');
                    });
        
    });
        </script>
    

</main>




                            <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="2296283905"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.1'
                   list-folded='false'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

            

                <div class="container row center-align"
                    style="margin-bottom: 15px !important;">
                    <div class="col s12 m8 l8 copy-right">
                        Copyright&nbsp;&copy;
                        
                            <span id="year">
                                2021-2022
                            </span>
                            
                                    <span id="year">
                                        2021
                                    </span>
                                    <a href="/about" target="_blank">
                                        Jack-zhang
                                    </a>
                                    <br>
                                    
                                        &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数
                                            :&nbsp;<span class="white-color">
                                                156.8k
                                            </span>
                                            
                                                
                                                    
                                                        
                                                            
                                                                
                                                                    <span id="busuanzi_container_site_pv">
                                                                        &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                                                                            <span id="busuanzi_value_site_pv"
                                                                                class="white-color"></span>
                                                                    </span>
                                                                    
                                                                        
                                                                            <span id="busuanzi_container_site_uv">
                                                                                &nbsp;|&nbsp;<i
                                                                                    class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                                                                                    <span id="busuanzi_value_site_uv"
                                                                                        class="white-color"></span>
                                                                            </span>
                                                                            
                                                                                <br>

                                                                                <!-- 运行天数提醒. -->
                                                                                
                                                                                    <span id="sitetime"> Loading
                                                                                        ...</span>
                                                                                    <script>
                                                                                        var calcSiteTime = function () {
                                                                                            var seconds = 1000;
                                                                                            var minutes = seconds * 60;
                                                                                            var hours = minutes * 60;
                                                                                            var days = hours * 24;
                                                                                            var years = days * 365;
                                                                                            var today = new Date();
                                                                                            var startYear = "2021";
                                                                                            var startMonth = "8";
                                                                                            var startDate = "22";
                                                                                            var startHour = "0";
                                                                                            var startMinute = "0";
                                                                                            var startSecond = "0";
                                                                                            var todayYear = today.getFullYear();
                                                                                            var todayMonth = today.getMonth() + 1;
                                                                                            var todayDate = today.getDate();
                                                                                            var todayHour = today.getHours();
                                                                                            var todayMinute = today.getMinutes();
                                                                                            var todaySecond = today.getSeconds();
                                                                                            var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                                                                                            var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                                                                                            var diff = t2 - t1;
                                                                                            var diffYears = Math.floor(diff / years);
                                                                                            var diffDays = Math.floor((diff / days) - diffYears * 365);

                                                                                            // 区分是否有年份.
                                                                                            var language = 'zh-CN';
                                                                                            if (startYear === String(todayYear)) {
                                                                                                document.getElementById("year").innerHTML = todayYear;
                                                                                                var daysTip = 'This site has been running for ' + diffDays + ' days';
                                                                                                if (language === 'zh-CN') {
                                                                                                    daysTip = '本站已运行 ' + diffDays + ' 天';
                                                                                                } else if (language === 'zh-HK') {
                                                                                                    daysTip = '本站已運行 ' + diffDays + ' 天';
                                                                                                }
                                                                                                document.getElementById("sitetime").innerHTML = daysTip;
                                                                                            } else {
                                                                                                document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                                                                                                var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                                                                                    + diffDays + ' days';
                                                                                                if (language === 'zh-CN') {
                                                                                                    yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                                                                                                } else if (language === 'zh-HK') {
                                                                                                    yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                                                                                                }
                                                                                                document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                                                                                            }
                                                                                        }

                                                                                        calcSiteTime();
                                                                                    </script>
                                                                                    
                                                                                        <br>
                                                                                        
                                                                                            <span id="icp"><img
                                                                                                    src="/medias/icp.png"
                                                                                                    style="vertical-align: text-bottom;" />
                                                                                                <a href="/tags/"
                                                                                                    target="_blank">
                                                                                                    苏ICP备2021008174号
                                                                                                </a>
                                                                                            </span>
                                                                                            
                    </div>
                    <div class="col s12 m4 l4 social-link social-statis">
                        
    <a href="https://github.com/Jack-Zhang-1314" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>









    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1553198027" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1553198027" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>


                    </div>
                </div>
</footer>

<div class="progress-bar"></div>

                                <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input style="color: #3d9b77;" type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                class="search-input" onblur="this.placeholder=''" onfocus="this.placeholder=''">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        var searchFunc = function (path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function (xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function () {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function () {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function (data) {
                            var isMatch = true;
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title !== '' && data_content !== '') {
                                keywords.forEach(function (keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i === 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start === 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substr(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function (keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                    });

                                    str += "<p class=\"search-result\">" + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        };

        searchFunc('/%20/%20search.xml', 'searchInput', 'searchResult');
    });
</script>
                                    <!-- 添加深色模式 -->
<svg aria-hidden="true" style="position: absolute; overflow: hidden; width: 0; height: 0">
    <symbol id="icon-sun" viewBox="0 0 1024 1024">
        <path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z"
            fill="#FFD878" p-id="8420"></path>
        <path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421">
        </path>
        <path
            d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z"
            fill="#4D5152" p-id="8422"></path>
        <path
            d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z"
            fill="#4D5152" p-id="8423"></path>
    </symbol>
    <symbol id="icon-moon" viewBox="0 0 1024 1024">
        <path
            d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z"
            fill="#FFB531" p-id="11345"></path>
        <path
            d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z"
            fill="#030835" p-id="11346"></path>
    </symbol>
</svg>
<a onclick="switchNightMode()" class="icon-V hidden" title="切换主题">
    <svg width="48" height="48" viewBox="0 0 1024 1024">
        <use id="modeicon" xlink:href="#icon-moon"></use>
    </svg>
</a>
<script>
    function checkNightMode() {
        '1' === localStorage.getItem('isDark') ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : '0' === localStorage.getItem('isDark') ? $('#modeicon').attr('xlink:href', '#icon-moon') : new Date().getHours() >= 20 || new Date().getHours() < 7 ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : matchMedia('(prefers-color-scheme: dark)').matches ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : $('#modeicon').attr('xlink:href', '#icon-moon')
    }
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
            setTimeout(function () {
                $('body').hasClass('DarkMode') ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#changeMode-top').removeClass('fa-sun').addClass('fa-moon'), $('#modeicon').attr('xlink:href', '#icon-moon')) : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')),
                    setTimeout(function () {
                        $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                            $(this).remove()
                        })
                    }, 2e3)
            })
    }
    function switchNightModeTop() {
        $('body').hasClass('DarkMode') ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#changeMode-top').removeClass('fa-sun').addClass('fa-moon'), $('#modeicon').attr('xlink:href', '#icon-moon')) : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun'))
    }
    checkNightMode()
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">

    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>

                                        <script
                                            src="/libs/materialize/materialize.min.js"></script>
                                        <script
                                            src="/libs/masonry/masonry.pkgd.min.js"></script>
                                        <script
                                            src="/libs/aos/aos.js"></script>
                                        <script
                                            src="/libs/scrollprogress/scrollProgress.min.js"></script>
                                        <script
                                            src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
                                        <script
                                            src="/js/matery.js"></script>

                                        <!-- Baidu Analytics -->

                                            <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

                                                
                                                    <script
                                                        src="/libs/others/clicklove.js"
                                                        async="async"></script>
                                                    
                                                        
                                                            <script async
                                                                src="/libs/others/busuanzi.pure.mini.js"></script>
                                                            

                                                                

                                                                        

                                                                                <!--腾讯兔小巢-->
                                                                                
                                                                                        

                                                                                                

                                                                                                            

                                                                                                                    
                                                                                                                        <script
                                                                                                                            src="/libs/instantpage/instantpage.js"
                                                                                                                            type="module"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
                                                                                                                        

                </body>

</html>